@{
	ViewData["Title"] = "Create Folder & Upload";
}
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.1/css/jquery.dataTables.min.css">
<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.1/js/jquery.dataTables.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

<div class="container mt-5">
	<h2 class="mb-4">📁 Create Folder & Upload File</h2>

	<form asp-action="UploadFile" asp-controller="Files" method="post" enctype="multipart/form-data">
		<div class="mb-3">
			<label for="folderName" class="form-label">Choose Folder to Upload</label>
			<select id="folderName" name="folderName" class="form-select" required>
				<option value="">-- Select Folder --</option>
				@foreach (var folder in ViewBag.Folders as List<string>)
				{
					<option value="@folder">@folder</option>
				}
			</select>
		</div>
		<div class="mb-3 d-flex gap-2">
			<button type="button" class="btn btn-warning fw-semibold shadow-sm px-4" onclick="enableNewFolderInput()" id="btnCreateNew">
				<i class="fas fa-folder-plus me-1"></i> Create New Folder
			</button>
			<button type="button" class="btn btn-primary fw-semibold shadow-sm px-4" onclick="addFolder()" id="btnAdd">
				<i class="fas fa-plus-circle me-1"></i> Add
			</button>
		</div>

		<div class="mb-3" id="newFolderDiv" style="display: block;">
			<input type="text" id="newFolderName" name="newFolderName" class="form-control" placeholder="Enter new folder name..." />
		</div>
		<div class="mb-3">
			<input type="file" name="file" class="form-control" required />
		</div>
		<button type="submit" class="btn btn-primary">
			<i class="fas fa-upload me-1"></i> Upload File
		</button>
	</form>
	<!-- Gợi ý: Nút quay lại -->
	<div class="mt-4">
		<a href="@Url.Action("Index", "Home")" class="btn btn-secondary">
			<i class="fas fa-arrow-left me-1"></i> Back to Folder
		</a>
	</div>
</div>
@section Scripts {
	<script>
		// Ẩn khung nhập thư mục mới khi trang vừa load
		$(document).ready(function () {
			document.getElementById("newFolderName").disabled = true;
			document.getElementById("btnAdd").disabled = true;
		});

		// document.getElementById("").addEventListener("click", function () {
		// 	document.getElementById("newFolderName").disabled = false;
		// });

		// Hiện ô nhập thư mục mới khi người dùng nhấn nút
		function enableNewFolderInput() {
			document.getElementById("newFolderName").disabled = false;
			document.getElementById("btnAdd").disabled = false;
			//document.getElementById("folderName").disabled = true;
		}

				function addFolder() {
			var newFolderValue = $("#newFolderName").val().trim();

			if (newFolderValue === "") {
				alert("Please enter a folder name.");
				return;
			}

			$.ajax({
				url: '@Url.Action("AddFolder", "Home")',
				type: 'POST',
				data: { newFolderName: newFolderValue },
				success: function (response) {
					if (response.success) {
						// Thêm folder vào dropdown
						var option = new Option(response.folder, response.folder, true, true);
						$("#folderName").append(option);

						// Cập nhật lại sidebar từ server
						$.get('@Url.Action("RefreshSidebar", "Home")', function (html) {
							$(".sidebar").html(`
								<h5 class="mb-3">
									<a href="@Url.Action("Index", "Home")">
										<i class="fas fa-folder-open me-2 text-warning"></i> Folder
									</a>
								</h5>
								` + html);
						});

						// Reset input
						$("#newFolderName").val("").prop("disabled", true);
						$("#btnAdd").prop("disabled", true);
					}
				},
				error: function () {
					alert("Failed to add folder. Please try again.");
				}
			});
		}
	</script>
}
